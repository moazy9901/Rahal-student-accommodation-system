  <div class="min-h-screen w-full bg-linear-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 px-4 sm:px-6 lg:px-8 py-8 transition-all duration-300">  <p-toast></p-toast>

  <!-- Questions Section -->
  <div *ngIf="!showResults() && !isLoadingQuestions()" class="max-w-4xl mx-auto">

    <!-- Header -->
    <div class="mb-8 animate-fade-in">
      <h1 class="text-3xl sm:text-4xl font-bold mb-3 text-gray-900 dark:text-gray-100">
        Find Your Perfect Accommodation
      </h1>
      <p class="text-lg text-gray-600 dark:text-gray-300">
        Answer a few questions to get personalized property recommendations tailored to your preferences
      </p>
    </div>

    <!-- Progress Bar -->
    <div class="mb-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
      <div class="flex justify-between items-center mb-4">
        <div>
          <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-200">
            Progress: {{currentCategoryName()}}
          </h3>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            Question {{totalQuestionsAnswered()}} of {{totalQuestionsRequired()}} required
          </p>
        </div>
        <div class="text-right">
          <p class="text-2xl font-bold text-[#9810fa]">
            {{progressPercentage() | number:'1.0-0'}}%
          </p>
        </div>
      </div>

      <!-- Progress Bar Visual -->
      <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden">
        <div
          class="h-full bg-linear-to-r from-[#9810fa] to-purple-600 rounded-full transition-all duration-500"
          [style.width.%]="progressPercentage()">
        </div>
      </div>

      <!-- Category Indicators -->
      <div class="flex justify-between mt-6 gap-2 flex-wrap">
        <button
          *ngFor="let category of categories(); let i = index"
          (click)="currentCategoryIndex.set(i)"
          class="px-3 py-2 rounded-lg text-xs font-semibold transition-all duration-300"
          [ngClass]="{
            'bg-[#9810fa] text-white shadow-lg': i === currentCategoryIndex(),
            'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600': i !== currentCategoryIndex()
          }">
          {{category}}
        </button>
      </div>
    </div>

    <!-- Questions Container -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 sm:p-8 border border-gray-200 dark:border-gray-700 mb-8">

      <!-- Current Group Title -->
      <div class="mb-8 pb-6 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2">
          {{currentCategoryName()}}
        </h2>
        <p class="text-gray-600 dark:text-gray-300">
          {{currentGroupQuestionCount()}} questions in this section
        </p>
      </div>

      <!-- Questions -->
      <div *ngIf="currentGroup()" class="space-y-6">

        <div *ngFor="let question of currentGroup()!.questions" class="question-item">

          <!-- Question Label -->
          <label class="block mb-3">
            <span class="text-gray-900 dark:text-gray-100 font-semibold text-lg">
              {{question.question}}
              <span *ngIf="question.is_required" class="text-red-500 ml-2">*</span>
            </span>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
              {{question.question_type | titlecase}}
            </p>
          </label>

          <!-- Text Input -->
          <input
            *ngIf="isTextQuestion(question)"
            type="text"
            [value]="formAnswers()[question.id] || ''"
            (change)="updateAnswer(question.id, $event.target.value)"
            placeholder="Enter your answer"
            class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 dark:border-gray-600
                   dark:bg-gray-700 dark:text-white focus:border-[#9810fa] focus:ring-2 focus:ring-purple-200
                   dark:focus:ring-purple-900 transition-all duration-300 outline-none">

          <!-- Single Select -->
          <div *ngIf="isSelectQuestion(question)" class="space-y-2">
            <div *ngFor="let option of getOptions(question)" class="flex items-center">
              <input
                type="radio"
                [id]="'option_' + question.id + '_' + option"
                [name]="'question_' + question.id"
                [value]="option"
                [checked]="formAnswers()[question.id] === option"
                (change)="updateAnswer(question.id, option)"
                class="w-4 h-4 text-[#9810fa] rounded-full cursor-pointer">
              <label [for]="'option_' + question.id + '_' + option"
                class="ml-3 text-gray-700 dark:text-gray-300 cursor-pointer font-medium hover:text-[#9810fa]
                       dark:hover:text-purple-400 transition-colors">
                {{option}}
              </label>
            </div>
          </div>

          <!-- Multiple Select -->
          <div *ngIf="isMultiSelectQuestion(question)" class="space-y-2">
            <div *ngFor="let option of getOptions(question)" class="flex items-center">
              <input
                type="checkbox"
                [id]="'multi_' + question.id + '_' + option"
                [name]="'question_' + question.id"
                [value]="option"
                [checked]="getMultiSelectValue(question.id).includes(option)"
                (change)="updateMultiSelectAnswer(question.id, option, $event.target.checked)"
                class="w-4 h-4 text-[#9810fa] rounded cursor-pointer">
              <label [for]="'multi_' + question.id + '_' + option"
                class="ml-3 text-gray-700 dark:text-gray-300 cursor-pointer font-medium hover:text-[#9810fa]
                       dark:hover:text-purple-400 transition-colors">
                {{option}}
              </label>
            </div>
          </div>

          <!-- Range Input -->
          <div *ngIf="isRangeQuestion(question)" class="space-y-2">
            <input
              type="range"
              [min]="getOptions(question)?.[0]?.min || 0"
              [max]="getOptions(question)?.[0]?.max || 100"
              [value]="formAnswers()[question.id] || 50"
              (change)="updateAnswer(question.id, $event.target.value)"
              class="w-full h-2 bg-gray-300 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer accent-[#9810fa]">
            <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400">
              <span>{{getOptions(question)?.[0]?.min || 0}}</span>
              <span class="font-semibold text-[#9810fa] text-lg">{{formAnswers()[question.id] || 50}}</span>
              <span>{{getOptions(question)?.[0]?.max || 100}}</span>
            </div>
          </div>

        </div>
      </div>

      <!-- Navigation Buttons -->
      <div class="flex gap-4 mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
        <button
          (click)="prevGroup()"
          [disabled]="currentCategoryIndex() === 0"
          class="flex-1 px-6 py-3 rounded-xl font-semibold transition-all duration-300
                 disabled:opacity-50 disabled:cursor-not-allowed
                 bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white
                 hover:bg-gray-300 dark:hover:bg-gray-600">
          <i class="fas fa-arrow-left mr-2"></i> Previous
        </button>

        <button
          (click)="nextGroup()"
          [disabled]="isSubmittingAnswers()"
          class="flex-1 px-6 py-3 rounded-xl font-semibold transition-all duration-300
                 disabled:opacity-50 disabled:cursor-not-allowed
                 bg-linear-to-r from-[#9810fa] to-purple-600 text-white
                 hover:shadow-lg hover:shadow-purple-500/50"
          [ngClass]="currentCategoryIndex() === (questionGroups().length - 1) ? 'bg-green-600 hover:bg-green-700' : ''">
          <span *ngIf="currentCategoryIndex() < (questionGroups().length - 1)">
            Next <i class="fas fa-arrow-right ml-2"></i>
          </span>
          <span *ngIf="currentCategoryIndex() === (questionGroups().length - 1)">
            <i *ngIf="isSubmittingAnswers()" class="fas fa-spinner fa-spin mr-2"></i>
            {{isSubmittingAnswers() ? 'Generating...' : 'Get Recommendations'}}
          </span>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading Questions -->
  <div *ngIf="isLoadingQuestions()" class="max-w-4xl mx-auto text-center py-16">
    <div class="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-[#9810fa]"></div>
    <p class="mt-6 text-xl text-gray-600 dark:text-gray-300 font-semibold">Loading questions...</p>
  </div>

  <!-- Results Section -->
  <div *ngIf="showResults()" class="max-w-7xl mx-auto">

    <!-- Results Header -->
    <div class="mb-8 animate-fade-in">
      <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
        <div>
          <h1 class="text-3xl sm:text-4xl font-bold mb-2 text-gray-900 dark:text-gray-100">
            Your Recommended Properties
          </h1>
          <p class="text-lg text-gray-600 dark:text-gray-300">
            We found <span class="font-bold text-[#9810fa]">{{recommendedProperties().length}}</span> properties matching your preferences
          </p>
        </div>

        <div class="flex gap-3">
          <button
            (click)="saveRecommendations()"
            class="px-6 py-3 rounded-xl font-semibold transition-all duration-300
                   bg-green-500 hover:bg-green-600 text-white shadow-md hover:shadow-lg
                   flex items-center gap-2">
            <i class="fas fa-save"></i> Save Results
          </button>

          <button
            (click)="restartRecommendation()"
            class="px-6 py-3 rounded-xl font-semibold transition-all duration-300
                   bg-linear-to-r from-[#9810fa] to-purple-600 text-white shadow-md hover:shadow-lg
                   flex items-center gap-2">
            <i class="fas fa-redo"></i> New Search
          </button>
        </div>
      </div>
    </div>

    <!-- Properties Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 mb-8">

      <article
        *ngFor="let property of paginatedProperties()"
        class="group bg-white dark:bg-gray-900 rounded-2xl shadow-md overflow-hidden
               hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1
               border border-gray-200 dark:border-gray-700 hover:border-[#9810fa]">

        <!-- Image Container -->
        <div class="relative overflow-hidden h-48">
          <img
            [src]="property.image"
            [alt]="property.title"
            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />

          <!-- Overlay -->
          <div class="absolute inset-0 bg-linear-to-t from-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

          <!-- Matching Percentage Badge (Top Right) -->
          <div class="absolute top-3 right-3 px-4 py-2 bg-linear-to-r from-green-500 to-emerald-600
                      text-white rounded-full shadow-lg font-bold text-lg flex items-center gap-2">
            <i class="fas fa-check-circle"></i>
            {{property.matching_percentage}}%
          </div>

          <!-- Available Spots Badge -->
          <span class="absolute top-3 left-3 px-3 py-1.5 bg-blue-500 text-white text-xs font-semibold
                       rounded-full shadow-md backdrop-blur-sm flex items-center gap-1">
            <i class="fa-solid fa-user-group"></i>
            {{property.available_spots}} {{property.available_spots === 1 ? 'Spot' : 'Spots'}}
          </span>

          <!-- Bills Included Badge -->
          <span *ngIf="property.bills_included"
            class="absolute bottom-3 left-3 px-3 py-1.5 bg-green-500 text-white text-xs font-semibold
                   rounded-full shadow-md backdrop-blur-sm flex items-center gap-1">
            <i class="fa-solid fa-check"></i>
            Bills Included
          </span>

          <!-- Quick View Button -->
          <button (click)="viewPropertyDetails(property.id)"
            class="absolute bottom-3 right-3 bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                   px-3 py-2 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-300
                   hover:bg-[#9810fa] hover:text-white font-semibold text-sm shadow-md
                   flex items-center gap-1">
            <i class="fa-solid fa-eye"></i>
          </button>
        </div>

        <!-- Content -->
        <div class="p-4">

          <!-- Title and Location -->
          <h3 class="font-semibold text-lg mb-1 text-gray-900 dark:text-white line-clamp-1
                     group-hover:text-[#9810fa] dark:group-hover:text-[#9810fa] transition-colors">
            {{ property.title }}
          </h3>
          <p class="text-sm text-gray-600 dark:text-gray-300 mb-3 flex items-center gap-1">
            <i class="fa-solid fa-location-dot text-[#9810fa]"></i>
            {{ property.location }}
          </p>

          <!-- Features Grid -->
          <div class="flex justify-between text-sm text-gray-700 dark:text-gray-300 mb-3 pb-3 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center gap-1">
              <i class="fa-solid fa-house"></i>
              <span>{{ property.rooms }} Room{{ property.rooms > 1 ? 's' : '' }}</span>
            </div>
            <div class="flex items-center gap-1">
              <i class="fa-solid fa-bath"></i>
              <span>{{ property.baths }} Bath{{ property.baths > 1 ? 's' : '' }}</span>
            </div>
            <div class="flex items-center gap-1">
              <i class="fa-solid fa-bed"></i>
              <span>{{ property.beds }} Bed{{ property.beds > 1 ? 's' : '' }}</span>
            </div>
          </div>

          <!-- Gender Badge -->
          <span class="inline-flex items-center gap-1 px-2 py-1 bg-indigo-50 dark:bg-indigo-900/30
                       text-indigo-700 dark:text-indigo-300 text-xs font-semibold rounded-full mb-3">
            <i class="fa-solid fa-user"></i>
            {{ property.gender }}
          </span>

          <!-- Reason/Match Info -->
          <p *ngIf="property.reason" class="text-xs text-gray-600 dark:text-gray-400 mb-3 italic">
            <i class="fas fa-lightbulb text-yellow-500 mr-1"></i>
            {{property.reason}}
          </p>

          <!-- Price and Action -->
          <div class="flex justify-between items-center">
            <div>
              <p class="font-bold text-lg text-[#9810fa] dark:text-[#9810fa]">
                ${{ property.price }}
              </p>
              <span class="text-xs text-gray-500 dark:text-gray-400">/month</span>
            </div>
            <button (click)="viewPropertyDetails(property.id)"
              class="bg-[#9810fa] hover:bg-purple-700 text-white px-3 py-2 rounded-lg text-xs font-bold
                     transition-all duration-300 shadow-sm hover:shadow-md flex items-center gap-1">
              <i class="fa-solid fa-arrow-right"></i>
              View
            </button>
          </div>

        </div>
      </article>

    </div>

    <!-- Pagination -->
    <div *ngIf="recommendedProperties().length > rows()"
         class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-4 sm:p-6
                border border-gray-200 dark:border-gray-700 flex justify-center">
      <p-paginator
        [first]="(currentPage() - 1) * rows()"
        [rows]="rows()"
        [totalRecords]="totalRecords()"
        (onPageChange)="onPageChange($event)"
        [rowsPerPageOptions]="[6, 12, 18]"
        styleClass="custom-paginator dark:paginator-dark">
      </p-paginator>
    </div>

    <!-- No Results -->
    <div *ngIf="recommendedProperties().length === 0"
         class="text-center py-16 bg-white dark:bg-gray-800 rounded-3xl shadow-lg border border-gray-200 dark:border-gray-700">
      <div class="text-6xl mb-4">ðŸ˜ž</div>
      <h3 class="text-2xl font-bold mb-2 text-gray-900 dark:text-white">No Matches Found</h3>
      <p class="text-gray-600 dark:text-gray-300 mb-6">Try adjusting your preferences and search again</p>
      <button (click)="restartRecommendation()"
        class="px-6 py-3 rounded-xl font-semibold transition-all duration-300
               bg-linear-to-r from-[#9810fa] to-purple-600 text-white shadow-md hover:shadow-lg
               flex items-center justify-center gap-2 mx-auto">
        <i class="fas fa-redo"></i> New Search
      </button>
    </div>
  </div>

</div>
