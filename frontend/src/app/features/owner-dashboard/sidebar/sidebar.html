<aside
  class="h-screen bg-[#5e1fbf] text-white shadow-xl transition-all duration-300 z-40 overflow-hidden
         dark:bg-[#2c0b5c] dark:text-gray-200"
  [ngClass]="isOpen ? 'w-64' : 'w-20'"
>
  <!-- Logo -->
  <div class="flex flex-col items-center py-5">
    <div
      class="rounded-full bg-white text-[#5e1fbf] font-bold flex items-center justify-center transition-all
             dark:bg-gray-200 dark:text-[#5e1fbf]"
      [ngClass]="isOpen ? 'w-16 h-16 text-3xl' : 'w-12 h-12 text-xl'"
    >
      <img [src]="avatarUrl()" class="w-full h-full flex items-center justify-center rounded-full object-cover cursor-pointer" />
    </div>

    <h2 *ngIf="isOpen" class="mt-3 text-lg font-semibold dark:text-gray-200">{{ user?.name }}</h2>
  </div>

  <!-- Toggle -->
  <button
    (click)="isOpen = !isOpen"
    [ngClass]="isOpen ? 'left-[17rem]' : 'left-[6rem]'"
    class="absolute top-2 transition-all duration-300 p-3 rounded-2xl bg-[#5e1fbf] hover:bg-[#7a3fe0] shadow-2xl shadow-purple-900
           dark:bg-[#3b246b] dark:hover:bg-[#5e1fbf]"
  >
    <i class="fas" [ngClass]="isOpen ? 'fa-angle-left' : 'fa-angle-right'"></i>
  </button>

  <!-- Menu -->
  <nav class="mt-4">
    <ul class="space-y-1">
      <li *ngFor="let item of menuItems">
        <a
          [routerLink]="item.route"
          routerLinkActive="active-item"
          [routerLinkActiveOptions]="{ exact: true }"
          class="group relative flex items-center gap-3 px-4 py-3 mx-2 rounded-lg
                 hover:bg-[#5e1fbf]/40 dark:hover:bg-[#7a3fe0]/40 transition"
        >
          <!-- Active Bar -->
          <span
            class="absolute left-0 top-0 h-full w-[3px] bg-white rounded-r-full
                   scale-y-0 group-[.active-item]:scale-y-100 transition
                   dark:bg-[#d1b3ff]"
          ></span>

          <!-- Icon -->
          <i class="text-lg w-6 text-white/80 group-hover:text-white dark:text-gray-300 dark:group-hover:text-white"
             [ngClass]="item.icon"></i>

          <!-- Label -->
          <span
            class="text-sm font-medium whitespace-nowrap transition-all
                   dark:text-gray-200"
            [ngClass]="isOpen ? 'opacity-100' : 'opacity-0 w-0 overflow-hidden'"
          >
            {{ item.label }}
          </span>

          <!-- Badge -->
          <span
            *ngIf="item.badge"
            class="ml-auto text-xs px-2 py-0.5 bg-white text-[#5e1fbf] rounded-full font-semibold
                   dark:bg-[#7a3fe0] dark:text-white"
            [ngClass]="isOpen ? 'opacity-100' : 'opacity-0 w-0 overflow-hidden'"
          >
            {{ item.badge }}
          </span>

          <!-- Tooltip (Collapsed) -->
          <div
            *ngIf="!isOpen"
            class="absolute left-full ml-2 px-2 py-1 bg-[#5e1fbf] text-white text-xs rounded shadow
                   opacity-0 group-hover:opacity-100 dark:bg-[#3b246b] dark:text-white transition"
          >
            {{ item.label }}
          </div>

          <!-- Tooltip for collapsed state -->
          <div
            *ngIf="!isOpen"
            class="hidden lg:block absolute left-full ml-4 px-3 py-2 bg-[#4c2db8] dark:bg-[#3b246b] text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-all duration-300 whitespace-nowrap shadow-xl pointer-events-none z-50"
          >
            <div class="flex items-center gap-2">
              {{ item.label }}
              <span
                *ngIf="item.badge"
                class="bg-gradient-to-r from-[#7a3fe0] to-[#5e1fbf] text-xs px-1.5 py-0.5 rounded-full font-bold"
              >
                {{ item.badge }}
              </span>
            </div>
            <div
              class="absolute -left-0 top-1/2 -translate-y-1/2 w-2 h-2 bg-[#4c2db8] dark:bg-[#3b246b] rotate-45"
            ></div>
          </div>
        </a>
      </li>
    </ul>
  </nav>
</aside>

<!-- Mobile Overlay -->
<div
  *ngIf="isOpen"
  class="fixed inset-0 md:bg-black/50 z-30 lg:hidden"
  (click)="isOpen = false"
></div>

<style>
.active-item {
  background-color: rgba(255, 255, 255, 0.25) !important;
  font-weight: 600;
  transition: background-color 0.3s;
}

.dark .active-item {
  background-color: rgba(190, 150, 255, 0.25) !important;
}
</style>
